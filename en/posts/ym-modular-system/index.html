<!doctype html>
<html class='no-js' lang=en>
    <head>
        <title>Isomorphic Example TEST</title>
        <link rel="icon" type="image/x-icon" href="/assets/favicon.ico"/>
        <script src="/assets/loader-26764a82cdd944e48447.js"></script>
<link rel="stylesheet" href="/assets/page-26764a82cdd944e48447.css"/>
<script src="/assets/head-26764a82cdd944e48447.js"></script>
        <script>
            (function(d, s, l, r) {
            if (typeof(s) !== 'undefined' && l.getItem('varya.me.fonts')) {
                r = [
                    '<style>',
                    l.getItem('varya.me.fonts'),
                    '</style>'
                ];
                document.write(r.join(''));
            }

            })(document, Storage, localStorage);
        </script>
    </head>
    <body class="page">
        <div id='contents'><div><header class="style__header___7cFNF"><div class="style__left___1nLlV" id="Header-Left"></div><div class="style__center___265v6"><logo class="style__logo___2yXgh">⋅⋅⋅<b class="style__var___11qBW">var</b>⋅<b class="style__ya___8D8Xm">ya</b>;<b class="style__cursor___2aaLd"></b></logo></div><div class="style__right___1RRr2" id="Header-Right"></div></header><div class="style__layout___2Ynks"><section class="style__main___1PTuI"><ul class="style__switcher___2YMLp"><li class="style__lang___kggY_"><a href="/" class="style__link___1ZFL2">en</a></li><li class="style__lang___kggY_"><a href="/ru/" class="style__link___1ZFL2">ru</a></li></ul><div class="style__article___2FW-a" role="main"><div class="style__body___XvMI0"><h1 class="style__header___ADINy">YM Modular System. Why?</h1></div><div class="style__text___1aEP8"><div class="style__share___2UNWm"><script type="text/javascript" src="//yandex.st/share/share.js" charset="utf-8"></script><span class="yashare-auto-init" data-yashareQuickServices="twitter,facebook,gplus" data-yashareL10n="en" data-yashareTheme="counter"></span></div><span class="style__details___ZaSIa author vcard">Published on 2/25/2014</span><div><p>The recently published <a href="http://bem.info/tutorials/articles/bem-js-tutorial/">step-by-step tutorial on
i-bem.js</a> mentioned <strong>YM
modular system</strong> as a base for component JavaScript solution behind BEM. Why do
we need another modular system? Let us see...
<excerpt/></p>
<p>The author of YM modules, <a href="https://github.com/dfilatov">Dmitry Filatov</a> recently
came up with an <a href="http://habrahabr.ru/post/213627/">article about YM modules</a> in
Russian. And below you can find the translation.</p>
<hr/>
<p>So, one more modular system? Besides CommonJS and AMD? Why should we care?</p>
<p>I will not write why modules and modular systems are needed, there are plenty of
articles about it. Let us rather proceed to the main question: why do we need
<em>another</em> modular system?<br/>
For sure, there are CommonJS and AMD, but working on large projects with them I faced
large drawbacks. One is that they are synchronous. This is not fatal, but in my
project we often had to provie different hacks for it.</p>
<p>Let us say, we have 3 modules: moduleA, moduleB and moduleC. moduleC depends on
both moduleA and moduleB. Initially I will describe this in code for all the
three solutions:</p>
<p>####CommonJS</p>
<p><em>moduleA.js:</em></p>
<pre><code class="language-js">module.exports = 'A';
</code></pre>
<p><em>moduleB.js:</em></p>
<pre><code class="language-js">module.exports = 'B';
</code></pre>
<p><em>moduleC.js:</em></p>
<pre><code class="language-js">var moduleA = require('A');
    moduleB = require('B');

module.exports = moduleA + moduleB + 'C';
</code></pre>
<p><em>Linking and usage:</em></p>
<pre><code class="language-js">var moduleC = require('C');
console.log(moduleC); // prints &quot;ABC&quot;
</code></pre>
<p>####AMD</p>
<p><em>moduleA.js:</em></p>
<pre><code class="language-js">define('A', function() {
    return 'A';
});
</code></pre>
<p><em>moduleB.js:</em>:</p>
<pre><code class="language-js">define('B', function() {
    return 'B';
});
</code></pre>
<p><em>moduleC.js:</em></p>
<pre><code class="language-js">define('С', ['A', 'B'], function(moduleA, moduleB) {
    return moduleA + moduleB + 'C';
});
</code></pre>
<p><em>Linking and usage:</em></p>
<pre><code class="language-js">require(['С'], function(moduleC) {
    console.log(moduleC); // prints &quot;ABC&quot;
});
</code></pre>
<p>####YM</p>
<p><em>moduleA.js:</em></p>
<pre><code class="language-js">modules.define('A', function(provide) {
    provide('A');
});
</code></pre>
<p><em>moduleB.js:</em></p>
<pre><code class="language-js">modules.define('B', function(provide) {
    provide('B');
});
</code></pre>
<p><em>moduleC.js:</em></p>
<pre><code class="language-js">modules.define('C', ['A', 'B'], function(provide, moduleA, moduleB) {
    provide(moduleA + moduleB + 'C');
});
</code></pre>
<p><em>Linking and usage:</em></p>
<pre><code class="language-js">modules.require(['С'], function(moduleC) {
    console.log(moduleC); // prints &quot;ABC&quot;
});
</code></pre>
<p>Nothing interesting yet. All three examples are similar, although you may
notice the <code>provide</code> callback in the YM example. What is it for?</p>
<p>Let us imagine a case that <code>moduleA</code> and <code>moduleB</code> cannot be resolved immediately
(synchronously, as it is required by CommonJS and AMD). Sometimes you need to
do an asynchronous action first. The simpliest example can be <code>setTimeout</code>.
There is no way to implement it elegantly with CommonJS and AMD.
But with <code>YM</code> it can be coded as follows:</p>
<p><em>moduleA.js:</em></p>
<pre><code class="language-js">modules.define('A', function(provide) {
    setTimeout(function() {
        provide('A');
   });
});
</code></pre>
<p><em>moduleB.js:</em></p>
<pre><code class="language-js">modules.define('B', function(provide) {
    setTimeout(function() {
        provide('B');
    });
});
</code></pre>
<p><em>moduleC.js:</em></p>
<pre><code class="language-js">modules.define('C', ['A', 'B'], function(provide, moduleA, moduleB) {
    provide(moduleA + moduleB + 'C');
});
</code></pre>
<p>Interestingly <code>moduleC</code> does not know anything about asynchronous actions in
its dependant modules. <em>Win!</em></p>
<h3>Real life example</h3>
<p>As for real file example, I often use the YandexMaps API
(<a href="http://api.yandex.com/maps/">http://api.yandex.com/maps/</a>, API of
<a href="http://maps.yandex.com/">Yandex.Maps</a>
public service). Yandex.Maps API has a complex loading scheme and this cannot be
done synchronously. This means that I cannot simply link it to a page
<code>&lt;script type=&quot;text/javascript&quot; src=&quot;url-of-ymaps.js&quot;&gt;&lt;/script&gt;</code> and be sure that
all the following scripts will get the API code ready. First I need to wait for
the event <code>ymaps.ready</code> to fire.</p>
<p>The project I am working for is quite complex; we have many classes inherited
from the basic API. For example, we have a <code>ComplexLayer</code> class based on <code>ymaps.Layer</code>.
With YM modules it is simple to implement. We define a <code>ymaps</code> module which loads
the API code, waits for the <code>ymaps.ready</code> event and then provides itself. All
the modules which have the <code>ymaps</code> module as a dependency only start to resolve
after this. As you can see, other modules know nothing about the asynchronicity of the
Yandex.Map API. <em>No hacks in code!</em></p>
<p><em>ymaps.js:</em></p>
<pre><code class="language-js">modules.define(
    'ymaps',
    ['loader', 'config'],
    function(provide, loader, config) {

    var url = config.hosts.ymaps + '/2.1.4/?lang=ru-RU' +
              '&amp;load=package.full&amp;coordorder=longlat';

    loader(url, function() {
        ymaps.ready(function() {
            provide(ymaps);
        });
    });
});
</code></pre>
<p>There are 2 other modules in use here: <code>loader</code> and <code>config</code>. I do not show
their code, but the first one loads scripts and the second one is a hash with
constant values.</p>
<p><em>ComplexLayer.js:</em></p>
<pre><code class="language-js">modules.define('ComplexLayer', ['inherit', 'ymaps'], function(provide, inherit, ymaps) {
    var ComplexLayer = inherit(ymaps.Layer, ...);

    provide(ComplexLayer);
});
</code></pre>
<p>We can do the same if jQuery is needed. There is a module to load jQuery:</p>
<pre><code class="language-js">modules.define(
    'jquery',
    ['loader',
    function(provide, loader) {

    loader('//yandex.st/jquery/2.1.0/jquery.min.js', function() {
        provide(jQuery.noConflict(true));
    });
});
</code></pre>
<p>Then we make other modules dependent on <code>jquery</code> module.</p>
<p>Thus, the whole project code is represented with modules. There is no global, no
need for agreement on the order of linking the scripts (including third-party ones),
no dirty hacks for asynchronicity.</p>
<p>And to wrap up, let me demonstrate you the YM modular system API (indeed, it has more
methods, and these are only the basic ones).</p>
<p><em>Defining a module:</em></p>
<pre><code class="language-js">void modules.define(
    String moduleName,
    [String[] dependencies],
    Function(
        Function(Object objectToProvide) provide,
        [Object resolvedDependency, ...],
        [Object previousDeclaration]
    ) declarationFunction
)
</code></pre>
<p><em>Requiring a module:</em></p>
<pre><code class="language-js">void modules.require(
    String[] dependencies,
    Function(
        [Object resolvedDependency, ...]
    ) callbackFunction
)
</code></pre>
<p>The project is open source and hosted at GitHub:
<a href="https://github.com/ymaps/modules">github.com/ymaps/modules</a>.</p>
</div></div></div><div class="style__comments___3emEu"><div><div id="disqus_thread"></div><script>
                      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                      var disqus_shortname = 'varya'; // required: replace example with your forum shortname

                      /* * * DON'T EDIT BELOW THIS LINE * * */
                      (function() {
                          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                      })();
                  </script></div></div></section><nav class="style__sidebar___2nkwz"><ul class="style__menu___-uZzl"><h3 class="style__title___3mAfQ">On this site</h3><li class="style__item___2LuN-"><a href="/en/posts/" class="style__link___1ZFL2">Tech Blog</a></li><li class="style__item___2LuN-"><a href="/en/content/" class="style__link___1ZFL2">Articles and talks</a></li><li class="style__item___2LuN-"><a href="/" class="style__link___1ZFL2">About me</a></li><li class="style__item___2LuN-"><a href="/en/life/" class="style__link___1ZFL2">My life</a></li></ul><div id="GitHub"></div></nav><aside class="style__prompt___1WAf7"><ul class="style__socialIco___14rtL"><li class="style__item___24Oaa"><ul class="style__feeds___lx7IA"><li class="style__item___24Oaa"><a class="style__rssText___1S0Bk" href="/en/feed.xml" title="New on Varya.me in English">en</a></li><li class="style__item___24Oaa"><a class="style__rssText___1S0Bk" href="/ru/feed.xml" title="Новые записи на Varya.me">ru</a></li></ul><a class="style__rss___2lUOQ style__ico___1PWaR" href="/feed.xml" title="New on Varya.me"></a></li><li class="style__item___24Oaa"><a class="style__twitter___3GPQl style__ico___1PWaR" href="https://twitter.com/varya_en" title="@varya_en" target="_blank"></a></li><li class="style__item___24Oaa"><a class="style__github___2GmrH style__ico___1PWaR" href="https://github.com/varya" target="_blank"></a></li><li class="style__item___24Oaa"><a class="style__facebook___2SOVV style__ico___1PWaR" href="http://www.facebook.com/varvara.stepanova.9" target="_blank"></a></li><li class="style__item___24Oaa"><a class="style__linkedin___2NaTD style__ico___1PWaR" href="http://www.linkedin.com/pub/varvara-stepanova/30/72a/96b" target="_blank"></a></li></ul></aside></div></div></div>

        <!-- Yandex.Metrika counter --><script type="text/javascript">(function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter20478625 = new Ya.Metrika({id:20478625, clickmap:true, trackLinks:true, accurateTrackBounce:true, trackHash:true}); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript><div><img src="//mc.yandex.ru/watch/20478625" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!-- /Yandex.Metrika counter -->
        <script src="/assets/page-26764a82cdd944e48447.js"></script>
<script src="/assets/index-26764a82cdd944e48447.js"></script>
<script src="http://localhost:35729/livereload.js"></script>
    </body>
</html>

