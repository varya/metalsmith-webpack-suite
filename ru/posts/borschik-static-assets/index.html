<!doctype html>
<html class='no-js' lang=ru>
    <head>
        <title>Isomorphic Example</title>
        <link rel="icon" type="image/x-icon" href="/assets/favicon.ico"/>
        <script src="/assets/loader-26764a82cdd944e48447.js"></script>
<link rel="stylesheet" href="/assets/page-26764a82cdd944e48447.css"/>
<script src="/assets/head-26764a82cdd944e48447.js"></script>
        <script>
            (function(d, s, l, r) {
            if (typeof(s) !== 'undefined' && l.getItem('varya.me.fonts')) {
                r = [
                    '<style>',
                    l.getItem('varya.me.fonts'),
                    '</style>'
                ];
                document.write(r.join(''));
            }

            })(document, Storage, localStorage);
        </script>
    </head>
    <body class="page">
        <div id='contents'><div><header class="style__header___7cFNF"><div class="style__left___1nLlV" id="Header-Left"></div><div class="style__center___265v6"><logo class="style__logo___2yXgh">⋅⋅⋅<b class="style__var___11qBW">var</b>⋅<b class="style__ya___8D8Xm">ya</b>;<b class="style__cursor___2aaLd"></b></logo></div><div class="style__right___1RRr2" id="Header-Right"></div></header><div class="style__layout___2Ynks"><section class="style__main___1PTuI"><ul class="style__switcher___2YMLp"><li class="style__lang___kggY_"><a href="/" class="style__link___1ZFL2">en</a></li><li class="style__lang___kggY_"><a href="/ru/" class="style__link___1ZFL2">ru</a></li></ul><div class="style__article___2FW-a" role="main"><div class="style__body___XvMI0"><h1 class="style__header___ADINy">Локальная разработка и удаленный хостинг статики</h1></div><div class="style__text___1aEP8"><div class="style__share___2UNWm"><script type="text/javascript" src="//yandex.st/share/share.js" charset="utf-8"></script><span class="yashare-auto-init" data-yashareQuickServices="twitter,facebook,gplus,vkontakte" data-yashareL10n="ru" data-yashareTheme="counter"></span></div><span class="style__details___ZaSIa author vcard">Опубликовано 3/12/2014</span><div><p>На прошлой неделе мне понадобилось сделать сайт, статика которого раздаётся с
другого сервера. Это касалось всех статических файлов: как подключенных к HTML
документу CSS и JavaScript, так и изображений и шрифтов, использованных уже в
их коде.<excerpt/> Хотя очевидно, что все они эти ресурсы должны быть локальными во
время разработки. То есть задача была придумать магию, которая знает, где будет
размещена статика, и преобразовывает относительные пути в коде в абсолютные
согласно этому знанию.</p>
<p>Эту задачу я решила при помощи инструмента
<a href="http://bem.info/tools/optimizers/borschik/">Borschik</a>. Борщик-сборщик, всем
должно быть понятно. :-)</p>
<center>
<iframe src="//embed.gettyimages.com/embed/135591409?et=B_T3l-shrE-pr9-ELe_wJw&sig=5haG67PAzCxGourA96ZB7m9LwSket1v9PpvXEXNIkBM=" width="508" height="407" frameborder="0" scrolling="no"></iframe>
</center>
<p>Демо-проект с этим решением находится в репозитории
<a href="https://github.com/varya/st-deliverer">varya/st-deliverer</a></p>
<h3>Структура проекта</h3>
<p>Как вы позже увидите, <code>borschik</code> можно гибко настроить. Так что возможна любая
структура проекта. В моём проекте все хранится в директории
<a href="b.com/varya/st-deliverer/tree/master/src">src</a>.
После сборки получается HTML-файлы в папке
<a href="https://github.com/varya/st-deliverer/tree/gh-pages/dist/html">dist/html</a>.
Проверьте его код, и вы убедитесь, что статические файлы подключены с другого
хоста по абсолютному пути.</p>
<pre><code class="language-html">&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Deliver static assets with Borschik&lt;/title&gt;
    &lt;link
      rel=&quot;stylesheet&quot;
      href=&quot;http://varya.github.io/stor.../styles.css&quot;/&gt;
  &lt;/head&gt;
  &lt;body
    class=&quot;page&quot;
    background=&quot;http://varya.github.io/stor.../grungy.jpg&quot;&gt;
  ...
</code></pre>
<p>Страничку можно <a href="http://varya.me/st-deliverer/dist/html/">открыть в браузере</a> и
насладиться моим дизайном и прекрасным котиком.</p>
<h3>Borschik в вашем проекте</h3>
<p>Borschik — это npm-пакет. Его можно установить глобально при помощи команды</p>
<pre><code class="language-bash">npm install -g borschik
</code></pre>
<p>Но лично я предпочитаю локальные зависимости, так что завожу в корне проекта
файл
<a href="https://github.com/varya/st-deliverer/blob/master/package.json">package.json</a>:</p>
<pre><code class="language-js">{
  ...
  &quot;dependencies&quot;: {
    &quot;borschik&quot;: &quot;0.4.2&quot;
  },
  ...
}
</code></pre>
<h3>Настройка</h3>
<p>Прежде чем начинать преобразования, нужно проинструктировать <code>borschik</code>, что
преобразовывать и как. Для этого нужен конфигурационный файл
<a href="https://github.com/varya/st-deliverer/blob/master/.borschik">.borschik</a>:</p>
<pre><code class="language-js">{
  &quot;paths&quot; : {
    &quot;src/img/&quot;: &quot;http://varya.github.io/stor.../st-deliverer/img/&quot;,
    &quot;src/css/&quot;: &quot;http://varya.github.io/stor.../st-deliverer/css/&quot;,
    &quot;src/font/&quot;: &quot;http://varya.github.io/storage/fonts/&quot;

  }
}
</code></pre>
<p>Заметьте, для разных путей можно настроить разную замену. Здесь это видно на
примере с фонами.</p>
<h3>Запускаем!</h3>
<p>Запустите <code>borschik</code> над файлом, содержащим ссылки на локальные статические
ресурсы, и вы получите результат преобразования. Например,</p>
<pre><code class="language-bash">./node_modules/borschik/bin/borschik \
  --input=src/css/styles.css
</code></pre>
<p>Чтобы использовать это в сборке, понадобится ещё один флаг <code>--output</code>,
сообщающий куда записать получившееся.</p>
<p><code>borschik</code> знаком с синтаксисом web-технологий. То есть &quot;ссылки&quot; размещенные в
простом тексте останутся нетронутыми.</p>
<h3>Система сборки</h3>
<p>Теперь <code>borschik</code> можно включить в систему сборки проекта. В моём случае это
небольшой
<a href="https://github.com/varya/st-deliverer/blob/master/Makefile">Makefile</a>, спасибо
<a href="https://github.com/alexeyten">@alexeyten</a> за 90% его содержания. :-) Но есть
также и плагин для grunt <a href="https://github.com/megatolya/grunt-borschik">megatolya/grunt-borschik</a>.<br/>
Конечно, <code>borschik</code> включен в системы сборки БЭМ-проектов
<a href="http://bem.info/tools/bem/bem-tools/">bem-tools</a>
и <a href="https://github.com/enb-make/enb">enb</a></p>
<h3>Результат</h3>
<p>Для закрепления <a href="http://varya.me/st-deliverer/dist/html/">проведайте котика ещё раз</a>.</p>
<p>А узнать о многих других возможностях <code>borschik</code> можно из статьи
<a href="http://ru.bem.info/articles/borschik/">http://ru.bem.info/articles/borschik/</a>.</p>
</div></div></div><div class="style__comments___3emEu"><div><div id="disqus_thread"></div><script>
                      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                      var disqus_shortname = 'varya'; // required: replace example with your forum shortname

                      /* * * DON'T EDIT BELOW THIS LINE * * */
                      (function() {
                          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                      })();
                  </script></div></div></section><nav class="style__sidebar___2nkwz"><ul class="style__menu___-uZzl"><h3 class="style__title___3mAfQ">На этом сайте</h3><li class="style__item___2LuN-"><a href="/ru/posts/" class="style__link___1ZFL2">Тех блог</a></li><li class="style__item___2LuN-"><a href="/ru/content/" class="style__link___1ZFL2">Статьи и презентации</a></li><li class="style__item___2LuN-"><a href="/ru/" class="style__link___1ZFL2">Обо мне</a></li><li class="style__item___2LuN-"><a href="/ru/life/" class="style__link___1ZFL2">Про жизнь</a></li></ul><div id="GitHub"></div></nav><aside class="style__prompt___1WAf7"><ul class="style__socialIco___14rtL"><li class="style__item___24Oaa"><ul class="style__feeds___lx7IA"><li class="style__item___24Oaa"><a class="style__rssText___1S0Bk" href="/en/feed.xml" title="New on Varya.me in English">en</a></li><li class="style__item___24Oaa"><a class="style__rssText___1S0Bk" href="/ru/feed.xml" title="Новые записи на Varya.me">ru</a></li></ul><a class="style__rss___2lUOQ style__ico___1PWaR" href="/feed.xml" title="New on Varya.me"></a></li><li class="style__item___24Oaa"><a class="style__twitter___3GPQl style__ico___1PWaR" href="https://twitter.com/varya_en" title="@varya_en" target="_blank"></a></li><li class="style__item___24Oaa"><a class="style__github___2GmrH style__ico___1PWaR" href="https://github.com/varya" target="_blank"></a></li><li class="style__item___24Oaa"><a class="style__facebook___2SOVV style__ico___1PWaR" href="http://www.facebook.com/varvara.stepanova.9" target="_blank"></a></li><li class="style__item___24Oaa"><a class="style__linkedin___2NaTD style__ico___1PWaR" href="http://www.linkedin.com/pub/varvara-stepanova/30/72a/96b" target="_blank"></a></li></ul></aside></div></div></div>

        <!-- Yandex.Metrika counter --><script type="text/javascript">(function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter20478625 = new Ya.Metrika({id:20478625, clickmap:true, trackLinks:true, accurateTrackBounce:true, trackHash:true}); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript><div><img src="//mc.yandex.ru/watch/20478625" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!-- /Yandex.Metrika counter -->
        <script src="/assets/page-26764a82cdd944e48447.js"></script>
<script src="/assets/index-26764a82cdd944e48447.js"></script>
<script src="http://localhost:35729/livereload.js"></script>
    </body>
</html>

